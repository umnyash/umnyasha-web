extends ../../layout/layout

block variables
  - var title = 'Оптимизация шрифтов'
  - var pageClass = 'article-page'

block content
  main
    article.article.container
      h1= title
      p Выбор современного шрифта, который обладает хорошей степенью сжатия — только первый шаг к оптимизации.
      h2 Свойство font-display
      p В разных браузерах логика рендеринга текста во время загрузки шрифта отличается, но это можно унифицировать используя свойство #[b font-display].
      p Значения:
      ul
        li #[b auto] — поведение по умолчанию, зависит от браузера.
        li #[b block] — текст не отображается в течение короткого периода (3 секунды), затем отрисовывается запасной шрифт, если основной ещё не загрузился. Как только загрузка завершается, текст перерисовывается снова.
        li #[b swap] — сразу же отрисовывается запасной шрифт, после загрузки шрифта — повторный рендеринг.
        li #[b fallback] — в течение очень короткого времени (100 миллисекунд) не отображается ничего, затем браузер использует запасной шрифт и ждёт 3 секунды — если шрифт всё ещё не загрузился, остаётся запасной шрифт. Если шрифт загрузится, то он применится только при обновлении страницы.
        li #[b optional] — текст не отображается в течение 100 миллисекунд, а затем отрисовывается запасным шрифтом. Даже если шрифт загрузится после этого, замена произойдёт только при обновлении страницы.
      p Оптимальное значение — #[b swap], его можно использовать в большинстве случаев, оно удобно для пользователей. При подключении шрифта с помощью Google Fonts это значение установлено по умолчанию.
      pre
        code.
          &lt;link rel="stylesheet"
            href="https://fonts.googleapis.com/css?
            family=Roboto:400,400i,700&
            #[b display="swap"]&gt;
      p При подключении шрифтов с помощью правила #[b @font-face], это значение можно установить с помощью свойства #[b font-display]:
      pre
        code.
          @font-face {
            font-family: "DIN Condensed";
            #[b font-display: swap;]
            src: url("/fonts/din.woff2") format("woff2"),
                 url("/fonts/din.woff") format("woff");
          }
      h2 Предзагрузка шрифтов
      p Ещё один способ оптимизации — предварительная загрузка шрифтов. С её помощью можно изменить обычную приоритизацию загрузки ресурсов, тем самым сказав браузеру, что важно загрузить шрифт в первую очередь.
      p Следует учесть, что браузер загрузит шрифт в любом случае — даже если он не используется на странице. И, обладая высоким приоритетом, эта загрузка может блокировать загрузку других ресурсов, поэтому нужно грамотно выбирать, что именно предзагружать. Например, если на странице используются три разных шрифта, стоит предзагрузить только основной шрифт без дополнительных начертаний.
      p Для того, чтобы предзагрузка сработала, нужно поместить в #[b &lt;head&gt;&lt;/head&gt;] ссылку на шрифт и задать атрибуту #[b rel] значение #[b preload], а также добавить тип ресурса, в данном случае — #[b font].
      pre
        code.
          &lt;link rel="preload" href="/fonts/roboto.woff2" as="font" type="font/woff2" crossorigin&gt;
      p Предзагружать можно и другие ресурсы — CSS-файлы, изображения и так далее.
      h2 Уменьшение количества глифов шрифта
      p По умолчанию шрифт может содержать глифы (буквы, символы) разных языков и просто редко используемые. С помощью свойства #[b unicode-range] можно установить диапазон нужных символов в системе Unicode, тогда браузер будет подгружать сабсет (подмножество) шрифта только в тот момент, когда на странице появится символ из этого диапазона. Предварительно нужно подготовить файлы шрифтов, разбив их на группы.
      p Например, можно отдельно подключить латиницу и кириллицу, если на сайте представлены версии на двух языках. И с помощью #[b unicode-range] браузер поймёт, какой сабсет нужен для конкретной страницы и загрузит только его. Такой файл будет иметь меньший вес и ускорит загрузку страницы.
      p Также можно проанализировать, какие конкретно глифы используются на сайте и создать кастомный сабсет исключительно с ними. Для этого есть #[a(href='https://github.com/filamentgroup/glyphhanger' target='_blank' rel='nofollow noopener') специальный инструмент].
      p При подключении шрифта с Google Fonts есть возможность создать и загрузить сабсет, включающий определённые символы, указанные в параметре #[b text]:
      p Например, когда шрифт нужен, только чтобы стилизовать текстовый логотип «Botanika»:
      pre
        code.
          &lt;link rel="stylesheet"
            href="https://fonts.googleapis.com/css?
            family=Roboto:400,400i,700&
            #[b subset=&text=Botanika&]
            display=swap"&gt;
      h2 Ускорение подключения шрифтов с внешнего домена
      p Теги ускоряющие подключение шрифтов с внешнего домена:
      pre
        code.
          &lt;link rel="dns-prefetch"&gt;
          &lt;link rel="preconnect" href="https://fonts.gstatic.com"&gt;
      p При подключении шрифта с внешнего домена, требуется сходить к его dns, узнать какой у него ip, сходить по этому ip, поздороваться по https и так далее.
      p Эти теги говорят «Мы на этом сайте используем ресурсы с внешнего домена. Заранее, браузер, сходи к этим ребятам, поздоровайся, наладь с ними отношения и когда придёт время, просто загрузи у них ресурсы».
